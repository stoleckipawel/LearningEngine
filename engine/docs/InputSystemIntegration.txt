

Phase 3: Platform Backend (Steps 6-8)
Step 6: IInputBackend.h — Platform Abstraction Interface
Goal: Define abstract interface for platform-specific input translation.

Files to Create:

engine/src/Platform/Input/IInputBackend.h
Dependencies: Steps 1, 2, 4

Deliverables:

ProcessMessage() virtual method
TranslateKey() virtual method
Mouse capture/cursor control virtual methods
Pure virtual destructor
Validation: Interface compiles, can be inherited.

Step 7: Win32InputBackend.h — Win32 Backend Declaration
Goal: Declare Win32-specific input backend.

Files to Create:

engine/src/Platform/Input/Win32/Win32InputBackend.h
Dependencies: Step 6

Deliverables:

Class declaration implementing IInputBackend
Private VK_* → Key translation table
Mouse capture state tracking
Validation: Header compiles with IInputBackend.

Step 8: Win32InputBackend.cpp — Win32 Implementation
Goal: Implement Win32 message translation and key mapping.

Files to Create:

engine/src/Platform/Input/Win32/Win32InputBackend.cpp
Dependencies: Step 7

Deliverables:

VK_* → Key translation table (constexpr array)
ProcessMessage(): Handle WM_KEYDOWN, WM_KEYUP, WM_SYSKEYDOWN, WM_SYSKEYUP
ProcessMessage(): Handle WM_MOUSEMOVE, WM_LBUTTONDOWN/UP, WM_RBUTTONDOWN/UP, WM_MBUTTONDOWN/UP
ProcessMessage(): Handle WM_MOUSEWHEEL, WM_XBUTTONDOWN/UP
Modifier extraction from GetKeyState()
Mouse capture via SetCapture()/ReleaseCapture()
Cursor visibility via ShowCursor()
Validation: Create backend instance, feed mock WM_* messages, verify events generated.

Phase 4: Input System (Steps 9-10)
Step 9: InputSystem.h — Central Hub Declaration
Goal: Declare the central input system API.

Files to Create:

engine/src/Platform/Input/InputSystem.h
Dependencies: Steps 1-6

Deliverables:

Constructor taking std::unique_ptr<IInputBackend>
Frame lifecycle: BeginFrame(), ProcessDeferredEvents(), EndFrame()
Message processing: OnWindowMessage()
State access: GetState()
Layer control: SetLayerEnabled(), IsLayerEnabled(), GetActiveLayer()
Subscription methods returning InputCallbackHandle
Mouse capture control methods
Validation: Header compiles, all method signatures defined.

Step 10: InputSystem.cpp — Central Hub Implementation
Goal: Implement event dispatch, callback management, and layer filtering.

Files to Create:

engine/src/Platform/Input/InputSystem.cpp
Dependencies: Step 9

Deliverables:

OnWindowMessage(): Delegate to backend, update state, fire immediate callbacks
Callback registration with unique ID generation per event type:
  - std::vector<CallbackEntry<KeyboardEvent>>    m_keyboardCallbacks
  - std::vector<CallbackEntry<MouseButtonEvent>> m_mouseButtonCallbacks
  - std::vector<CallbackEntry<MouseMoveEvent>>   m_mouseMoveCallbacks
  - std::vector<CallbackEntry<MouseWheelEvent>>  m_mouseWheelCallbacks
Callback unsubscription (thread-safe with mutex)
Separate typed deferred event queues (no std::variant):
  - std::vector<KeyboardEvent>    m_deferredKeyboardEvents
  - std::vector<MouseButtonEvent> m_deferredMouseButtonEvents
  - std::vector<MouseMoveEvent>   m_deferredMouseMoveEvents
  - std::vector<MouseWheelEvent>  m_deferredMouseWheelEvents
ProcessDeferredEvents(): Iterate each typed queue, fire typed callbacks
Layer priority filtering in dispatch
SetWindowSize() for normalized coordinate calculation
Validation: Subscribe to key press, simulate message, verify callback fires.

Phase 5: Render Camera (Steps 11-12)
Step 11: RenderCamera.h — Thread-Safe Camera Declaration
Goal: Declare thread-safe camera for renderer consumption.

Files to Create:

engine/src/Renderer/Camera/RenderCamera.h
Dependencies: DirectXMath (existing)

Deliverables:

Position, rotation setters (thread-safe)
SetTransform() for atomic multi-field update
Projection parameter setters
Position, direction, vector getters
Matrix getters (view, projection, viewProjection)
XMFLOAT4X4 getters for GPU upload
Validation: Header compiles, interface matches existing Camera usage patterns.

Step 12: RenderCamera.cpp — Thread-Safe Camera Implementation
Goal: Implement spinlock-based thread-safe camera with lazy matrix caching.

Files to Create:

engine/src/Renderer/Camera/RenderCamera.cpp
Dependencies: Step 11

Deliverables:

Spinlock acquire/release helpers using std::atomic_flag
Transform setters with spinlock protection
Rotation-to-direction vector calculation
View matrix computation from position/direction/up
Projection matrix computation
Dirty flag for lazy matrix recomputation
GetRightVector() via cross product
Validation: Set position from thread A, read matrix from thread B, verify correct values.

Phase 6: Camera Controller (Steps 13-14)
Step 13: CameraController.h — Input Consumer Declaration
Goal: Declare gameplay-side camera controller.

Files to Create:

engine/src/Gameplay/Camera/CameraController.h
Dependencies: Steps 9, 11

Deliverables:

Constructor taking RenderCamera& and InputSystem&
Update(float deltaTime) method
Configuration setters: move speed, sprint multiplier, sensitivity, invert Y
Enable/disable control
IsLooking() query
Validation: Header compiles, dependencies injected via constructor.

Step 14: CameraController.cpp — Input Consumer Implementation
Goal: Implement flying camera with WASD/arrows and middle-click look.

Files to Create:

engine/src/Gameplay/Camera/CameraController.cpp
Dependencies: Step 13

Deliverables:

Subscribe to MouseButtonPressed/Released for middle-click detection
BeginLook(): Capture mouse, hide cursor
EndLook(): Release mouse, show cursor
ProcessMovement(): Poll WASD + arrows, apply to camera position
ProcessMouseLook(): Read mouse delta, apply to camera rotation
Sprint modifier when Shift held
Layer check before processing (skip if UI layer active)
Validation: Instantiate controller, simulate input, verify camera transform changes.

Phase 7: Integration (Steps 15-16)
Step 15: Window + InputSystem Wiring
Goal: Connect Window's WndProc to InputSystem.

Files to Modify:

Window.h
Window.cpp
Dependencies: Step 10

Deliverables:

Add SetInputSystem(InputSystem*) or pass via constructor
In OnWindowMessage(): Forward input messages to InputSystem::OnWindowMessage() before GUI
Update window size notification to InputSystem on WM_SIZE
Remove or deprecate direct input handling in Window
Validation: Window forwards WM_KEYDOWN to InputSystem, callback fires.

Step 16: App Integration + GCamera Retirement
Goal: Wire everything together, replace GCamera singleton.

Files to Modify:

engine/src/App.h
App.cpp
Renderer.h (if exists)
All files referencing GCamera
Files to Delete/Deprecate:

engine/src/Camera.h (old singleton)
engine/src/Camera.cpp (old singleton)
Deliverables:

App owns: Window, InputSystem, RenderCamera, CameraController
Initialization order: Window → InputSystem (with Win32Backend) → RenderCamera → CameraController
Frame loop order:
InputSystem.BeginFrame()
Window.PumpMessages()
InputSystem.ProcessDeferredEvents()
InputSystem.SetLayerEnabled(UI, ImGui::GetIO().WantCaptureKeyboard)
CameraController.Update(deltaTime)
Render (using RenderCamera matrices)
InputSystem.EndFrame()
Replace all GCamera references with RenderCamera access via App/Renderer
Update shader constant buffer upload to use RenderCamera::GetViewProjectionMatrix()
Validation: Run application, press WASD to move camera, hold middle-click + drag to look around.

